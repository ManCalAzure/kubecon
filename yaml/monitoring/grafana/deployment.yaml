# # monitoring/grafana/deployment.yaml
# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   name: grafana
#   namespace: grafana
# spec:
#   replicas: 3
#   revisionHistoryLimit: 2
#   selector:
#     matchLabels: { app: grafana }
#   template:
#     metadata:
#       labels: { app: grafana }
#     spec:
#       terminationGracePeriodSeconds: 30
#       topologySpreadConstraints:
#         - maxSkew: 1
#           topologyKey: kubernetes.io/hostname
#           whenUnsatisfiable: ScheduleAnyway
#           labelSelector:
#             matchLabels: { app: grafana }
#       affinity:
#         podAntiAffinity:
#           preferredDuringSchedulingIgnoredDuringExecution:
#             - weight: 100
#               podAffinityTerm:
#                 topologyKey: kubernetes.io/hostname
#                 labelSelector:
#                   matchLabels: { app: grafana }
#       containers:
#         - name: grafana
#           image: grafana/grafana:11.2.0
#           imagePullPolicy: IfNotPresent
#           ports:
#             - containerPort: 3000
#               name: http
#           env:
#             - name: GF_SECURITY_ADMIN_USER
#               valueFrom: { secretKeyRef: { name: grafana-secrets, key: GF_SECURITY_ADMIN_USER } }
#             - name: GF_SECURITY_ADMIN_PASSWORD
#               valueFrom: { secretKeyRef: { name: grafana-secrets, key: GF_SECURITY_ADMIN_PASSWORD } }
#             - name: GF_SECURITY_SECRET_KEY
#               valueFrom: { secretKeyRef: { name: grafana-secrets, key: GF_SECURITY_SECRET_KEY } }
#             - name: GF_DATABASE_TYPE
#               value: postgres
#             - name: GF_DATABASE_HOST
#               value: postgres.grafana.svc.cluster.local:5432
#             - name: GF_DATABASE_USER
#               valueFrom: { secretKeyRef: { name: grafana-secrets, key: POSTGRES_USER } }
#             - name: GF_DATABASE_PASSWORD
#               valueFrom: { secretKeyRef: { name: grafana-secrets, key: POSTGRES_PASSWORD } }
#             - name: GF_DATABASE_NAME
#               valueFrom: { secretKeyRef: { name: grafana-secrets, key: POSTGRES_DB } }
#             - name: GF_SERVER_ROOT_URL
#               value: "%(protocol)s://%(domain)s/"
#             - name: GF_SERVER_ENABLE_GZIP
#               value: "true"
#           readinessProbe:
#             httpGet: { path: /login, port: 3000 }
#             initialDelaySeconds: 10
#             periodSeconds: 10
#           livenessProbe:
#             httpGet: { path: /api/health, port: 3000 }
#             initialDelaySeconds: 30
#             periodSeconds: 30
#           resources:
#             requests:
#               cpu: 200m
#               memory: 256Mi
#             limits:
#               cpu: "1"
#               memory: 1Gi
